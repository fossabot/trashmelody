image: java:1.8.0-jdk

stages:
  - prepare
  - check
  - build
  - test

java-version:
  stage: prepare
  script:
    # Checking Java version + Directories
    - java -version
    - readlink -f $(which java)
  retry: 1
  except:
    - schedules

gradle-version:
  stage: prepare
  script:
    # Checking Gradle version
    - gradle -version
  retry: 1
  except:
    - schedules

set-paths:
  stage: prepare
  script:
    - export PATH=$PATH:/opt/gradle/gradle-4.2.1/bin
    - export JAVA_HOME=/usr/lib/jvm/java-8-openjdk
    - export PATH=$PATH:/usr/lib/jvm/java-8-openjdk/bin
  only:
    - web

gradle-check:
  stage: check
  script:
    # Gradle check for correct dependency imports
    - gradle check

gradle-tasks:
  stage: check
  script:
    # Gives out lists of Gradle Tasks
    - gradle -q tasks

gradle-clean:
  stage: check
  script:
    # Deletes previous build cache
    - gradle clean

build-game:
  stage: build
  script:
    # Pretty much like compiling the files
    - gradle assemble
  only:
    - develop
    - master
    - /^feature.*$/

run-game:
  stage: test
  script:
    # Do gradle check and gradle assemble
    - gradle run
  only:
    - develop
    - master
    - /^feature.*$/

export-game:
  stage: export
  script:
    # Export all files to .jar & make archive
    - gradle fatJar
  only:
    - repository
    - master
  artifacts:
    paths:
      - build/*.jar
  expire_in: 1 week
